{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState } from 'vuex'; // 按需引入节流模块(默认导出,不需要加花括号)\n\nimport throttle from 'lodash/throttle';\nexport default {\n  name: 'TypeNav',\n\n  // 组件挂在完毕,向服务器发请求\n  data() {\n    return {\n      currentIndex: -1,\n      show: true\n    };\n  },\n\n  methods: {\n    // 为鼠标进入事件设置节流,throttle函数别用箭头寒素,可能出现this问题\n    changeIndex: throttle(function (index) {\n      // 鼠标移上某个一级分类的index\n      // 正常情况:操作很慢,鼠标进入每一个一级分类,都会触发鼠标进入事件\n      // 异常情况 :操作很快,鼠标进入每一个一级分类,但只有部分触发\n      // 浏览器反应不过来,当前回调有一些大量业务,就会出现卡顿现象\n      // console.log(index)\n      this.currentIndex = index;\n    }, 50),\n\n    leaveShow() {\n      this.currentIndex = -1;\n\n      if (this.$route.path != '/home') {\n        this.show = false;\n      }\n    },\n\n    goSearch(event) {\n      // 编程式导航 + 事件委派\n      // 存在问题,事件委派,把全部子系欸但的事件委派给父节点,如何确定点击的是a标签\n      //  如何确定点击的是几级导航\n      let element = event.target; // 自定义属性时大写,但在dataset中是小写,所以引入是要去掉驼峰\n\n      let {\n        categoryname,\n        category1id,\n        category2id,\n        category3id\n      } = element.dataset;\n\n      if (categoryname) {\n        // 整理路由跳转的参数\n        // 要跳转的路由名称\n        let location = {\n          name: 'search'\n        }; // 选中的产品名称\n\n        let query = {\n          categoryName: categoryname\n        };\n\n        if (category1id) {\n          query.category1Id = category1id;\n        } else if (category2id) {\n          query.category2Id = category2id;\n        } else {\n          query.category3Id = category3id;\n        }\n\n        if (this.$route.params) {\n          location.params = this.$route.params;\n          location.query = query; // console.log(location)\n        }\n\n        this.$router.push(location); // 最终实现的结果是\n        // this.$router.push({name:'search,query:{categoryName:categoryName,category某Id:category某Id}})\n      }\n    },\n\n    enterShow() {\n      if (this.$route.path != '/home') {\n        this.show = true;\n      }\n    }\n\n  },\n\n  mounted() {\n    // 每次跳转都要发一次数据请求,效率不高,影响性能,所以将请求放到App根组件中,只发送一次\n    // this.$store.dispatch('categoryList')\n    if (this.$route.path != '/home') {\n      this.show = false;\n    }\n  },\n\n  computed: { ...mapState({\n      // 右侧需要一个函数,当使用这个计算属性时,就会调用这个函数\n      categoryList: state => {\n        // console.log(state)\n        return state.home.categoryList;\n      }\n    })\n  }\n};","map":null,"metadata":{},"sourceType":"module"}