{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState } from 'vuex';\nexport default {\n  name: 'Trade',\n\n  data() {\n    return {\n      msg: '',\n      orderId: ''\n    };\n  },\n\n  mounted() {\n    this.$store.dispatch('getUserAddress');\n    this.$store.dispatch('getOrderInfo');\n  },\n\n  computed: { ...mapState({\n      addressInfo: state => state.trade.address,\n      orderInfo: state => state.trade.orderInfo\n    }),\n\n    userDefaultAddress() {\n      // find查找数组中符合条件的元素\n      let userDefaultAddress = this.addressInfo.find(item => item.isDefault == 1);\n      return userDefaultAddress || {};\n    }\n\n  },\n  methods: {\n    // 修改默认地址\n    changeDefault(address, addressInfo) {\n      addressInfo.forEach(item => item.isDefault = 0);\n      address.isDefault = 1;\n    },\n\n    async submitOrder() {\n      let {\n        tradeNo\n      } = this.orderInfo;\n      let data = {\n        // 最终收件人的名字\n        consignee: this.userDefaultAddress.consignee,\n        // 最终收件人的电话\n        consigneeTel: this.userDefaultAddress.phoneNum,\n        // 派送地址\n        deliveryAddress: this.userDefaultAddress.fullAddress,\n        paymentWay: 'ONLINE',\n        orderComment: this.msg,\n        orderDetailList: this.orderInfo.detailArrayList\n      };\n      let result = await this.$API.reqSubmitOrder(tradeNo, data); // console.log(result)\n\n      if (result.code == 200) {\n        this.orderId = result.data;\n        this.$router.push('/pay?orderId=' + this.orderId);\n      } else {\n        alert(result.data);\n      }\n    }\n\n  }\n};","map":null,"metadata":{},"sourceType":"module"}